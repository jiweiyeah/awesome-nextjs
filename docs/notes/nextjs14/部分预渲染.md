---
title: éƒ¨åˆ†é¢„æ¸²æŸ“
author: è€¶å’Œåš
createTime: 2024/08/10 20:48:04
permalink: /nextjs14/rendering/partial-prerendering/
---

### **éƒ¨åˆ†é¢„æ¸²æŸ“**

éƒ¨åˆ†é¢„æ¸²æŸ“(PPR)ä½¿æ‚¨èƒ½å¤Ÿåœ¨åŒä¸€è·¯ç”±ä¸­ç»“åˆé™æ€å’ŒåŠ¨æ€ç»„ä»¶ã€‚

åœ¨æ„å»ºè¿‡ç¨‹ä¸­,Next.js ä¼šå°½å¯èƒ½å¤šåœ°é¢„æ¸²æŸ“è·¯ç”±ã€‚å¦‚æœæ£€æµ‹åˆ°[åŠ¨æ€](https://nextjs.org/docs/app/building-your-application/rendering/server-components#dynamic-rendering)ä»£ç ,æ¯”å¦‚ä»ä¼ å…¥è¯·æ±‚ä¸­è¯»å–æ•°æ®,æ‚¨å¯ä»¥ä½¿ç”¨ [React Suspense](https://react.dev/reference/react/Suspense) è¾¹ç•ŒåŒ…è£…ç›¸å…³ç»„ä»¶ã€‚Suspense è¾¹ç•Œçš„ fallback å°†è¢«åŒ…å«åœ¨é¢„æ¸²æŸ“çš„ HTML ä¸­ã€‚

::: warning
éƒ¨åˆ†é¢„æ¸²æŸ“æ˜¯ä¸€ä¸ª**å®éªŒæ€§**åŠŸèƒ½,å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚å®ƒè¿˜ä¸é€‚åˆåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚
:::

![éƒ¨åˆ†é¢„æ¸²æŸ“çš„äº§å“é¡µé¢,æ˜¾ç¤ºé™æ€å¯¼èˆªå’Œäº§å“ä¿¡æ¯,ä»¥åŠåŠ¨æ€è´­ç‰©è½¦å’Œæ¨èäº§å“](https://nextjs.org/_next/image?url=%2Flearn%2Flight%2Fthinking-in-ppr.png&w=3840&q=75)

> **ğŸ¥ è§‚çœ‹:** ä¸ºä»€ä¹ˆä½¿ç”¨ PPR ä»¥åŠå®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ â†’ [YouTube (10 åˆ†é’Ÿ)](https://www.youtube.com/watch?v=MTcPrTIBkpA)ã€‚

-----

### **èƒŒæ™¯**

PPR ä½¿æ‚¨çš„ Next.js æœåŠ¡å™¨èƒ½å¤Ÿç«‹å³å‘é€é¢„æ¸²æŸ“çš„å†…å®¹ã€‚

ä¸ºäº†é˜²æ­¢å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨çš„ç€‘å¸ƒæ•ˆåº”,åŠ¨æ€ç»„ä»¶åœ¨æä¾›åˆå§‹é¢„æ¸²æŸ“çš„åŒæ—¶å¼€å§‹ä»æœåŠ¡å™¨å¹¶è¡Œæµå¼ä¼ è¾“ã€‚è¿™ç¡®ä¿äº†åŠ¨æ€ç»„ä»¶å¯ä»¥åœ¨æµè§ˆå™¨åŠ è½½å®¢æˆ·ç«¯ JavaScript ä¹‹å‰å¼€å§‹æ¸²æŸ“ã€‚

ä¸ºäº†é¿å…ä¸ºæ¯ä¸ªåŠ¨æ€ç»„ä»¶åˆ›å»ºå¤šä¸ª HTTP è¯·æ±‚,PPR èƒ½å¤Ÿå°†é™æ€é¢„æ¸²æŸ“å’ŒåŠ¨æ€ç»„ä»¶ç»„åˆåˆ°ä¸€ä¸ª HTTP è¯·æ±‚ä¸­ã€‚è¿™ç¡®ä¿äº†æ¯ä¸ªåŠ¨æ€ç»„ä»¶ä¸éœ€è¦å¤šæ¬¡ç½‘ç»œå¾€è¿”ã€‚

-----

### **ä½¿ç”¨éƒ¨åˆ†é¢„æ¸²æŸ“**

#### **æ¸è¿›å¼é‡‡ç”¨ (ç‰ˆæœ¬ 15)**

åœ¨ Next.js 15 ä¸­,æ‚¨å¯ä»¥é€šè¿‡åœ¨ `next.config.js` ä¸­å°† [`ppr`](https://nextjs.org/docs/app/api-reference/next-config-js/ppr) é€‰é¡¹è®¾ç½®ä¸º `incremental`,å¹¶åœ¨æ–‡ä»¶é¡¶éƒ¨å¯¼å‡º `experimental_ppr` [è·¯ç”±é…ç½®é€‰é¡¹](https://nextjs.org/docs/app/api-reference/file-conventions/route-segment-config),æ¥åœ¨[å¸ƒå±€](https://nextjs.org/docs/app/building-your-application/routing/layouts-and-templates)å’Œ[é¡µé¢](https://nextjs.org/docs/app/building-your-application/routing/pages)ä¸­é€æ­¥é‡‡ç”¨éƒ¨åˆ†é¢„æ¸²æŸ“:

::: code-tabs
@tab next.config.ts
``` typescript
import type { NextConfig } from 'next'
 
const nextConfig: NextConfig = {
  experimental: {
    ppr: 'incremental',
  },
}
 
export default nextConfig
```
@tab next.config.js
``` javascript
/** @type {import('next').NextConfig} */
const nextConfig = {
  experimental: {
    ppr: 'incremental',
  },
}
 
module.exports = nextConfig
```
:::

::: code-tabs
@tab app/page.tsx
``` typescript
import { Suspense } from "react"
import { StaticComponent, DynamicComponent, Fallback } from "@/app/ui"
 
export const experimental_ppr = true
 
export default function Page() {
  return {
     <>
      <StaticComponent />
      <Suspense fallback={<Fallback />}>
        <DynamicComponent />
      </Suspense>
     </>
  };
}
```
@tab app/page.js
``` javascript  
import { Suspense } from "react"
import { StaticComponent, DynamicComponent, Fallback } from "@/app/ui"
 
export const experimental_ppr = true
 
export default function Page() {
  return {
     <>
      <StaticComponent />
      <Suspense fallback={<Fallback />}>
        <DynamicComponent />
      </Suspense>
     </>
  };
}
```
:::

::: tip
*   æ²¡æœ‰ `experimental_ppr` çš„è·¯ç”±å°†é»˜è®¤ä¸º `false`,å¹¶ä¸”ä¸ä¼šä½¿ç”¨ PPR è¿›è¡Œé¢„æ¸²æŸ“ã€‚æ‚¨éœ€è¦ä¸ºæ¯ä¸ªè·¯ç”±æ˜¾å¼é€‰æ‹©åŠ å…¥ PPRã€‚
*   `experimental_ppr` å°†åº”ç”¨äºè·¯ç”±æ®µçš„æ‰€æœ‰å­é¡¹,åŒ…æ‹¬åµŒå¥—å¸ƒå±€å’Œé¡µé¢ã€‚æ‚¨ä¸éœ€è¦å°†å…¶æ·»åŠ åˆ°æ¯ä¸ªæ–‡ä»¶ä¸­,åªéœ€æ·»åŠ åˆ°è·¯ç”±çš„é¡¶å±‚æ®µå³å¯ã€‚
*   è¦ä¸ºå­æ®µç¦ç”¨ PPR,æ‚¨å¯ä»¥åœ¨å­æ®µä¸­å°† `experimental_ppr` è®¾ç½®ä¸º `false`ã€‚
:::

#### **å¯ç”¨ PPR (ç‰ˆæœ¬ 14)**

åœ¨ Next.js 14 ä¸­,æ‚¨å¯ä»¥é€šè¿‡å°† [`ppr`](https://nextjs.org/docs/app/api-reference/next-config-js/ppr) é€‰é¡¹æ·»åŠ åˆ°æ‚¨çš„ `next.config.js` æ–‡ä»¶ä¸­æ¥å¯ç”¨å®ƒã€‚è¿™å°†åº”ç”¨äºåº”ç”¨ç¨‹åºä¸­çš„æ‰€æœ‰è·¯ç”±:

::: code-tabs
@tab next.config.ts
``` typescript
import type { NextConfig } from 'next'
 
const nextConfig: NextConfig = {
  experimental: {
    ppr: true,
  },
}
 
export default nextConfig
```
@tab next.config.js
``` javascript
/** @type {import('next').NextConfig} */
const nextConfig = {
  experimental: {
    ppr: true,
  },
}
 
module.exports = nextConfig
```
:::

-----

### **åŠ¨æ€ç»„ä»¶**

åœ¨ `next build` æœŸé—´ä¸ºæ‚¨çš„è·¯ç”±åˆ›å»ºé¢„æ¸²æŸ“æ—¶,Next.js è¦æ±‚åŠ¨æ€å‡½æ•°ç”¨ React Suspense åŒ…è£…ã€‚ç„¶å,å°† `fallback` åŒ…å«åœ¨é¢„æ¸²æŸ“ä¸­ã€‚

ä¾‹å¦‚,ä½¿ç”¨ `cookies()` æˆ– `headers()` ç­‰å‡½æ•°:

::: code-tabs
@tab app/user.tsx
``` typescript
import { cookies } from 'next/headers'
 
export function User() {
  const session = cookies().get('session')?.value
  return '...'
}
```
@tab app/user.js
``` javascript
import { cookies } from 'next/headers'
 
export function User() {
  const session = cookies().get('session')?.value
  return '...'
}
```
:::

æ­¤ç»„ä»¶éœ€è¦æŸ¥çœ‹ä¼ å…¥çš„è¯·æ±‚ä»¥è¯»å– cookiesã€‚è¦ä¸ PPR ä¸€èµ·ä½¿ç”¨,æ‚¨åº”è¯¥ç”¨ Suspense åŒ…è£…ç»„ä»¶:

::: code-tabs
@tab app/page.tsx
``` typescript
import { Suspense } from 'react'
import { User, AvatarSkeleton } from './user'
 
export const experimental_ppr = true
 
export default function Page() {
  return (
    <section>
      <h1>This will be prerendered</h1>
      <Suspense fallback={<AvatarSkeleton />}>
        <User />
      </Suspense>
    </section>
  )
}
```
@tab app/page.js
``` javascript
import { Suspense } from 'react'
import { User, AvatarSkeleton } from './user'
 
export const experimental_ppr = true
 
export default function Page() {
  return (
    <section>
      <h1>This will be prerendered</h1>
      <Suspense fallback={<AvatarSkeleton />}>
        <User />
      </Suspense>
    </section>
  )
}
```
:::

ç»„ä»¶ä»…åœ¨è®¿é—®å€¼æ—¶é€‰æ‹©åŠ¨æ€æ¸²æŸ“ã€‚

ä¾‹å¦‚,å¦‚æœæ‚¨ä» `page` ä¸­è¯»å– `searchParams`,æ‚¨å¯ä»¥å°†æ­¤å€¼ä½œä¸º prop è½¬å‘ç»™å¦ä¸€ä¸ªç»„ä»¶:

::: code-tabs
@tab app/page.tsx
``` typescript
import { Table } from './table'
 
export default function Page({
  searchParams,
}: {
  searchParams: { sort: string }
}) {
  return (
    <section>
      <h1>This will be prerendered</h1>
      <Table searchParams={searchParams} />
    </section>
  )
}
```
@tab app/page.js
``` javascript
import { Table } from './table'
 
export default function Page({ searchParams }) {
  return (
    <section>
      <h1>This will be prerendered</h1>
      <Table searchParams={searchParams} />
    </section>
  )
}
```
:::

åœ¨è¡¨æ ¼ç»„ä»¶å†…éƒ¨,è®¿é—® `searchParams` ä¸­çš„å€¼å°†ä½¿ç»„ä»¶åŠ¨æ€è¿è¡Œ:

::: code-tabs
@tab app/table.tsx
``` typescript
export function Table({ searchParams }: { searchParams: { sort: string } }) {
  const sort = searchParams.sort === 'true'
  return '...'
}
```
@tab app/table.js
``` javascript
export function Table({ searchParams }: {
  searchParams: { sort: string }
}) {
  const sort = searchParams.sort === 'true';
  return '...'
}
```
:::