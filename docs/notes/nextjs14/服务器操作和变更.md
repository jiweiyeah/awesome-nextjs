---
title: æœåŠ¡å™¨æ“ä½œå’Œå˜æ›´
author: è€¶å’Œåš
createTime: 2024/08/10 20:48:04
permalink: /nextjs14/data-fetching/server-actions-and-mutations/
---

### **æœåŠ¡å™¨æ“ä½œå’Œå˜æ›´**

[æœåŠ¡å™¨æ“ä½œ](https://react.dev/reference/rsc/server-actions)æ˜¯åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œçš„**å¼‚æ­¥å‡½æ•°**ã€‚å®ƒä»¬å¯ä»¥åœ¨æœåŠ¡å™¨ç»„ä»¶å’Œå®¢æˆ·ç«¯ç»„ä»¶ä¸­è°ƒç”¨,ç”¨äºå¤„ç† Next.js åº”ç”¨ç¨‹åºä¸­çš„è¡¨å•æäº¤å’Œæ•°æ®å˜æ›´ã€‚

:::tip
ğŸ¥ äº†è§£æ›´å¤šå…³äºä½¿ç”¨æœåŠ¡å™¨æ“ä½œè¿›è¡Œå˜æ›´çš„ä¿¡æ¯ â†’ [YouTube (10 åˆ†é’Ÿ)](https://youtu.be/dDpZfOQBMaU?si=cJZHlUu_jFhCzHUg)ã€‚
:::

-----

### **çº¦å®š**

æœåŠ¡å™¨æ“ä½œå¯ä»¥ä½¿ç”¨ React çš„ [`"use server"`](https://react.dev/reference/react/use-server) æŒ‡ä»¤å®šä¹‰ã€‚æ‚¨å¯ä»¥å°†è¯¥æŒ‡ä»¤æ”¾åœ¨ `async` å‡½æ•°çš„é¡¶éƒ¨,å°†è¯¥å‡½æ•°æ ‡è®°ä¸ºæœåŠ¡å™¨æ“ä½œ,æˆ–è€…å°†å…¶æ”¾åœ¨å•ç‹¬æ–‡ä»¶çš„é¡¶éƒ¨,å°†è¯¥æ–‡ä»¶çš„æ‰€æœ‰å¯¼å‡ºæ ‡è®°ä¸ºæœåŠ¡å™¨æ“ä½œã€‚

#### **æœåŠ¡å™¨ç»„ä»¶**

æœåŠ¡å™¨ç»„ä»¶å¯ä»¥ä½¿ç”¨å†…è”å‡½æ•°çº§åˆ«æˆ–æ¨¡å—çº§åˆ«çš„ `"use server"` æŒ‡ä»¤ã€‚è¦å†…è”æœåŠ¡å™¨æ“ä½œ,è¯·å°† `"use server"` æ·»åŠ åˆ°å‡½æ•°ä½“çš„é¡¶éƒ¨:

::: code-tabs
@tab app/page.tsx
``` typescript
export default function Page() {
  // Server Action
  async function create() {
    'use server'
    // Mutate data
  }
 
  return '...'
}
```
@tab app/page.js
``` javascript
export default function Page() {
  // Server Action
  async function create() {
    'use server'
    // Mutate data
  }
 
  return '...'
}
```
:::

#### **å®¢æˆ·ç«¯ç»„ä»¶**

è¦åœ¨å®¢æˆ·ç«¯ç»„ä»¶ä¸­è°ƒç”¨æœåŠ¡å™¨æ“ä½œ,è¯·åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶å¹¶åœ¨å…¶é¡¶éƒ¨æ·»åŠ  `"use server"` æŒ‡ä»¤ã€‚è¯¥æ–‡ä»¶ä¸­çš„æ‰€æœ‰å‡½æ•°éƒ½å°†è¢«æ ‡è®°ä¸ºå¯åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç»„ä»¶ä¸­é‡ç”¨çš„æœåŠ¡å™¨æ“ä½œ:

::: code-tabs
@tab app/actions.ts
``` typescript
'use server'
 
export async function create() {}
```
@tab app/actions.js
``` javascript
'use server'
 
export async function create() {}
```
:::

::: code-tabs
@tab app/ui/button.tsx
``` typescript
'use client'
 
import { create } from '@/app/actions'
 
export function Button() {
  return <Button onClick={create} />
}
```
@tab app/ui/button.js
``` javascript
'use client'
 
import { create } from '@/app/actions'
 
export function Button() {
  return <Button onClick={create} />
}
```
:::

#### **å°†æ“ä½œä½œä¸º props ä¼ é€’**

æ‚¨è¿˜å¯ä»¥å°†æœåŠ¡å™¨æ“ä½œä½œä¸º prop ä¼ é€’ç»™å®¢æˆ·ç«¯ç»„ä»¶:

``` typescript
<ClientComponent updateItemAction={updateItem} />
```

::: code-tabs
@tab app/client-component.tsx
``` typescript
'use client'
 
export default function ClientComponent({
  updateItemAction,
}: {
  updateItemAction: (formData: FormData) => void
}) {
  return <form action={updateItemAction}>{/* ... */}</form>
}
```
@tab app/client-component.jsx
``` javascript
'use client'
 
export default function ClientComponent({ updateItemAction }) {
  return <form action={updateItemAction}>{/* ... */}</form>
}
```
:::

é€šå¸¸,Next.js TypeScript æ’ä»¶ä¼šæ ‡è®° `client-component.tsx` ä¸­çš„ `updateItemAction`,å› ä¸ºå®ƒæ˜¯ä¸€ä¸ªé€šå¸¸æ— æ³•åœ¨å®¢æˆ·ç«¯-æœåŠ¡å™¨è¾¹ç•Œä¹‹é—´åºåˆ—åŒ–çš„å‡½æ•°ã€‚ç„¶è€Œ,åä¸º `action` æˆ–ä»¥ `Action` ç»“å°¾çš„ props è¢«å‡å®šä¸ºæ¥æ”¶æœåŠ¡å™¨æ“ä½œã€‚è¿™åªæ˜¯ä¸€ä¸ªå¯å‘å¼æ–¹æ³•,å› ä¸º TypeScript æ’ä»¶å®é™…ä¸Šå¹¶ä¸çŸ¥é“å®ƒæ˜¯æ¥æ”¶æœåŠ¡å™¨æ“ä½œè¿˜æ˜¯æ™®é€šå‡½æ•°ã€‚è¿è¡Œæ—¶ç±»å‹æ£€æŸ¥ä»ç„¶ä¼šç¡®ä¿æ‚¨ä¸ä¼šæ„å¤–åœ°å°†å‡½æ•°ä¼ é€’ç»™å®¢æˆ·ç«¯ç»„ä»¶ã€‚
é€šå¸¸,Next.js TypeScript æ’ä»¶ä¼šæ ‡è®° `client-component.tsx` ä¸­çš„ `updateItemAction`,å› ä¸ºå®ƒæ˜¯ä¸€ä¸ªé€šå¸¸æ— æ³•åœ¨å®¢æˆ·ç«¯-æœåŠ¡å™¨è¾¹ç•Œä¹‹é—´åºåˆ—åŒ–çš„å‡½æ•°ã€‚ç„¶è€Œ,åä¸º `action` æˆ–ä»¥ `Action` ç»“å°¾çš„ props è¢«å‡å®šä¸ºæ¥æ”¶æœåŠ¡å™¨æ“ä½œã€‚è¿™åªæ˜¯ä¸€ä¸ªå¯å‘å¼æ–¹æ³•,å› ä¸º TypeScript æ’ä»¶å®é™…ä¸Šå¹¶ä¸çŸ¥é“å®ƒæ˜¯æ¥æ”¶æœåŠ¡å™¨æ“ä½œè¿˜æ˜¯æ™®é€šå‡½æ•°ã€‚è¿è¡Œæ—¶ç±»å‹æ£€æŸ¥ä»ç„¶ä¼šç¡®ä¿æ‚¨ä¸ä¼šæ„å¤–åœ°å°†å‡½æ•°ä¼ é€’ç»™å®¢æˆ·ç«¯ç»„ä»¶ã€‚

-----

### **è¡Œä¸º**

* æœåŠ¡å™¨æ“ä½œå¯ä»¥ä½¿ç”¨ [`<form>` å…ƒç´ ](about:blank#forms)ä¸­çš„ `action` å±æ€§è°ƒç”¨:
    * æœåŠ¡å™¨ç»„ä»¶é»˜è®¤æ”¯æŒæ¸è¿›å¢å¼º,è¿™æ„å‘³ç€å³ä½¿ JavaScript å°šæœªåŠ è½½æˆ–è¢«ç¦ç”¨,è¡¨å•ä¹Ÿä¼šè¢«æäº¤ã€‚
    * åœ¨å®¢æˆ·ç«¯ç»„ä»¶ä¸­,å¦‚æœ JavaScript å°šæœªåŠ è½½,è°ƒç”¨æœåŠ¡å™¨æ“ä½œçš„è¡¨å•å°†æ’é˜Ÿæäº¤,ä¼˜å…ˆè€ƒè™‘å®¢æˆ·ç«¯æ°´åˆã€‚
    * æ°´åˆå,æµè§ˆå™¨åœ¨è¡¨å•æäº¤æ—¶ä¸ä¼šåˆ·æ–°ã€‚
* æœåŠ¡å™¨æ“ä½œä¸é™äº `<form>`,è¿˜å¯ä»¥ä»äº‹ä»¶å¤„ç†ç¨‹åºã€`useEffect`ã€ç¬¬ä¸‰æ–¹åº“å’Œå…¶ä»–è¡¨å•å…ƒç´ (å¦‚ `<button>`)ä¸­è°ƒç”¨ã€‚
* æœåŠ¡å™¨æ“ä½œä¸ Next.js [ç¼“å­˜å’Œé‡æ–°éªŒè¯](https://nextjs.org/docs/app/building-your-application/caching)æ¶æ„é›†æˆã€‚å½“è°ƒç”¨æ“ä½œæ—¶,Next.js å¯ä»¥åœ¨å•ä¸ªæœåŠ¡å™¨å¾€è¿”ä¸­è¿”å›æ›´æ–°çš„ UI å’Œæ–°æ•°æ®ã€‚
* åœ¨å¹•å,æ“ä½œä½¿ç”¨ `POST` æ–¹æ³•,å¹¶ä¸”åªæœ‰è¿™ç§ HTTP æ–¹æ³•å¯ä»¥è°ƒç”¨å®ƒä»¬ã€‚
* æœåŠ¡å™¨æ“ä½œçš„å‚æ•°å’Œè¿”å›å€¼å¿…é¡»å¯ç”± React åºåˆ—åŒ–ã€‚è¯·å‚é˜… React æ–‡æ¡£ä¸­çš„[å¯åºåˆ—åŒ–å‚æ•°å’Œå€¼](https://react.dev/reference/react/use-server#serializable-parameters-and-return-values)åˆ—è¡¨ã€‚
* æœåŠ¡å™¨æ“ä½œæ˜¯å‡½æ•°ã€‚è¿™æ„å‘³ç€å®ƒä»¬å¯ä»¥åœ¨åº”ç”¨ç¨‹åºçš„ä»»ä½•åœ°æ–¹é‡ç”¨ã€‚
* æœåŠ¡å™¨æ“ä½œç»§æ‰¿å®ƒä»¬æ‰€ä½¿ç”¨çš„é¡µé¢æˆ–å¸ƒå±€çš„[è¿è¡Œæ—¶](https://nextjs.org/docs/app/building-your-application/rendering/edge-and-nodejs-runtimes)ã€‚
* æœåŠ¡å™¨æ“ä½œç»§æ‰¿å®ƒä»¬æ‰€ä½¿ç”¨çš„é¡µé¢æˆ–å¸ƒå±€çš„[è·¯ç”±æ®µé…ç½®](https://nextjs.org/docs/app/api-reference/file-conventions/route-segment-config),åŒ…æ‹¬ `maxDuration` ç­‰å­—æ®µã€‚

-----

### **ç¤ºä¾‹**

#### **è¡¨å•**

React æ‰©å±•äº† HTML [`<form>`](https://developer.mozilla.org/docs/Web/HTML/Element/form) å…ƒç´ ,å…è®¸ä½¿ç”¨ `action` prop è°ƒç”¨æœåŠ¡å™¨æ“ä½œã€‚

åœ¨è¡¨å•ä¸­è°ƒç”¨æ—¶,æ“ä½œä¼šè‡ªåŠ¨æ¥æ”¶ [`FormData`](https://developer.mozilla.org/docs/Web/API/FormData/FormData) å¯¹è±¡ã€‚æ‚¨ä¸éœ€è¦ä½¿ç”¨ React çš„ `useState` æ¥ç®¡ç†å­—æ®µ,è€Œæ˜¯å¯ä»¥ä½¿ç”¨åŸç”Ÿçš„ [`FormData` æ–¹æ³•](https://developer.mozilla.org/en-US/docs/Web/API/FormData#instance_methods)æå–æ•°æ®:

::: code-tabs
@tab app/invoices/page.tsx
``` typescript
export default function Page() {
  async function createInvoice(formData: FormData) {
    'use server'
 
    const rawFormData = {
      customerId: formData.get('customerId'),
      amount: formData.get('amount'),
      status: formData.get('status'),
    }
 
    // mutate data
    // revalidate cache
  }
 
  return <form action={createInvoice}>...</form>
}
```
@tab app/invoices/page.jsx
``` javascript
export default function Page() {
  async function createInvoice(formData) {
    'use server'
 
    const rawFormData = {
      customerId: formData.get('customerId'),
      amount: formData.get('amount'),
      status: formData.get('status'),
    }
 
    // mutate data
    // revalidate cache
  }
 
  return <form action={createInvoice}>...</form>
}
```
:::

::: tip
* ç¤ºä¾‹: [å¸¦æœ‰åŠ è½½å’Œé”™è¯¯çŠ¶æ€çš„è¡¨å•](https://github.com/vercel/next.js/tree/canary/examples/next-forms)
* åœ¨å¤„ç†æœ‰å¤šä¸ªå­—æ®µçš„è¡¨å•æ—¶,æ‚¨å¯èƒ½æƒ³è€ƒè™‘ä½¿ç”¨ [`entries()`](https://developer.mozilla.org/en-US/docs/Web/API/FormData/entries) æ–¹æ³•å’Œ JavaScript çš„ [`Object.fromEntries()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/fromEntries)ã€‚ä¾‹å¦‚: `const rawFormData = Object.fromEntries(formData)`ã€‚éœ€è¦æ³¨æ„çš„æ˜¯,`formData` å°†åŒ…å«é¢å¤–çš„ `$ACTION_` å±æ€§ã€‚
* æŸ¥çœ‹ [React `<form>` æ–‡æ¡£](https://react.dev/reference/react-dom/components/form#handle-form-submission-with-a-server-action)äº†è§£æ›´å¤šä¿¡æ¯ã€‚

#### **ä¼ é€’é¢å¤–å‚æ•°**

æ‚¨å¯ä»¥ä½¿ç”¨ JavaScript çš„ `bind` æ–¹æ³•å‘æœåŠ¡å™¨æ“ä½œä¼ é€’é¢å¤–å‚æ•°ã€‚

::: code-tabs
@tab app/client-component.tsx
``` typescript
'use client'
 
import { updateUser } from './actions'
 
export function UserProfile({ userId }: { userId: string }) {
  const updateUserWithId = updateUser.bind(null, userId)
 
  return (
    <form action={updateUserWithId}>
      <input type="text" name="name" />
      <button type="submit">Update User Name</button>
    </form>
  )
}
```
@tab app/client-component.js
``` javascript
'use client'
 
import { updateUser } from './actions'
 
export function UserProfile({ userId }) {
  const updateUserWithId = updateUser.bind(null, userId)
 
  return (
    <form action={updateUserWithId}>
      <input type="text" name="name" />
      <button type="submit">Update User Name</button>
    </form>
  )
}
```
:::

æœåŠ¡å™¨æ“ä½œå°†æ¥æ”¶ `userId` å‚æ•°,ä»¥åŠè¡¨å•æ•°æ®:

::: code-tabs
@tab app/actions.js
``` javascript
'use server'
 
export async function updateUser(userId, formData) {}
```
:::

::: tip
* å¦ä¸€ç§æ–¹æ³•æ˜¯å°†å‚æ•°ä½œä¸ºéšè—è¾“å…¥å­—æ®µä¼ é€’ç»™è¡¨å•(ä¾‹å¦‚ `<input type="hidden" name="userId" value={userId} />`)ã€‚ä½†æ˜¯,è¯¥å€¼å°†æˆä¸ºæ¸²æŸ“çš„ HTML çš„ä¸€éƒ¨åˆ†,å¹¶ä¸”ä¸ä¼šè¢«ç¼–ç ã€‚
* `.bind` åœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ç»„ä»¶ä¸­éƒ½æœ‰æ•ˆã€‚å®ƒè¿˜æ”¯æŒæ¸è¿›å¢å¼ºã€‚
:::

#### **åµŒå¥—è¡¨å•å…ƒç´ **

æ‚¨è¿˜å¯ä»¥åœ¨ `<form>` å†…éƒ¨åµŒå¥—çš„å…ƒç´ (å¦‚ `<button>`ã€`<input type="submit">` å’Œ `<input type="image">`)ä¸­è°ƒç”¨æœåŠ¡å™¨æ“ä½œã€‚è¿™äº›å…ƒç´ æ¥å— `formAction` prop æˆ–[äº‹ä»¶å¤„ç†ç¨‹åº](about:blank#event-handlers)ã€‚

è¿™åœ¨æ‚¨æƒ³åœ¨è¡¨å•ä¸­è°ƒç”¨å¤šä¸ªæœåŠ¡å™¨æ“ä½œçš„æƒ…å†µä¸‹å¾ˆæœ‰ç”¨ã€‚ä¾‹å¦‚,æ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªç‰¹å®šçš„ `<button>` å…ƒç´ æ¥ä¿å­˜å¸–å­è‰ç¨¿,ä»¥åŠå‘å¸ƒå®ƒã€‚æœ‰å…³æ›´å¤šä¿¡æ¯,è¯·å‚é˜… [React `<form>` æ–‡æ¡£](https://react.dev/reference/react-dom/components/form#handling-multiple-submission-types)ã€‚

#### **ç¨‹åºåŒ–è¡¨å•æäº¤**

æ‚¨å¯ä»¥ä½¿ç”¨ [`requestSubmit()`](https://developer.mozilla.org/en-US/docs/Web/API/HTMLFormElement/requestSubmit) æ–¹æ³•ä»¥ç¼–ç¨‹æ–¹å¼è§¦å‘è¡¨å•æäº¤ã€‚ä¾‹å¦‚,å½“ç”¨æˆ·ä½¿ç”¨ `âŒ˜` + `Enter` é”®ç›˜å¿«æ·é”®æäº¤è¡¨å•æ—¶,æ‚¨å¯ä»¥ç›‘å¬ `onKeyDown` äº‹ä»¶:

::: code-tabs
@tab app/entry.tsx
``` typescript
'use client'
 
export function Entry() {
  const handleKeyDown = (e: React.KeyboardEvent<HTMLTextAreaElement>) => {
    if (
      (e.ctrlKey || e.metaKey) &&
      (e.key === 'Enter' || e.key === 'NumpadEnter')
    ) {
      e.preventDefault()
      e.currentTarget.form?.requestSubmit()
    }
  }
 
  return (
    <div>
      <textarea name="entry" rows={20} required onKeyDown={handleKeyDown} />
    </div>
  )
}
```
@tab app/entry.jsx
``` javascript
'use client'
 
export function Entry() {
  const handleKeyDown = (e) => {
    if (
      (e.ctrlKey || e.metaKey) &&
      (e.key === 'Enter' || e.key === 'NumpadEnter')
    ) {
      e.preventDefault()
      e.currentTarget.form?.requestSubmit()
    }
  }
 
  return (
    <div>
      <textarea name="entry" rows={20} required onKeyDown={handleKeyDown} />
    </div>
  )
}
```
:::

è¿™å°†è§¦å‘æœ€è¿‘çš„ `<form>` ç¥–å…ˆçš„æäº¤,ä»è€Œè°ƒç”¨æœåŠ¡å™¨æ“ä½œã€‚

#### **æœåŠ¡å™¨ç«¯è¡¨å•éªŒè¯**

æ‚¨å¯ä»¥ä½¿ç”¨ HTML å±æ€§(å¦‚ `required` å’Œ `type="email"`)è¿›è¡ŒåŸºæœ¬çš„å®¢æˆ·ç«¯è¡¨å•éªŒè¯ã€‚

å¯¹äºæ›´é«˜çº§çš„æœåŠ¡å™¨ç«¯éªŒè¯,æ‚¨å¯ä»¥ä½¿ç”¨åƒ [zod](https://zod.dev/) è¿™æ ·çš„åº“åœ¨å˜æ›´æ•°æ®ä¹‹å‰éªŒè¯è¡¨å•å­—æ®µ:

::: code-tabs
@tab app/actions.ts
``` typescript
'use server'
 
import { z } from 'zod'
 
const schema = z.object({
  email: z.string({
    invalid_type_error: 'Invalid Email',
  }),
})
 
export default async function createUser(formData: FormData) {
  const validatedFields = schema.safeParse({
    email: formData.get('email'),
  })
 
  // Return early if the form data is invalid
  if (!validatedFields.success) {
    return {
      errors: validatedFields.error.flatten().fieldErrors,
    }
  }
 
  // Mutate data
}
```
@tab app/actions.js
``` javascript
'use server'
 
import { z } from 'zod'
 
const schema = z.object({
  email: z.string({
    invalid_type_error: 'Invalid Email',
  }),
})
 
export default async function createsUser(formData) {
  const validatedFields = schema.safeParse({
    email: formData.get('email'),
  })
 
  // Return early if the form data is invalid
  if (!validatedFields.success) {
    return {
      errors: validatedFields.error.flatten().fieldErrors,
    }
  }
 
  // Mutate data
}
```
:::

ä¸€æ—¦åœ¨æœåŠ¡å™¨ä¸ŠéªŒè¯äº†å­—æ®µ,æ‚¨å¯ä»¥åœ¨æ“ä½œä¸­è¿”å›ä¸€ä¸ªå¯åºåˆ—åŒ–çš„å¯¹è±¡,å¹¶ä½¿ç”¨ React çš„ [`useActionState`](https://react.dev/reference/react/useActionState) é’©å­å‘ç”¨æˆ·æ˜¾ç¤ºæ¶ˆæ¯ã€‚

* é€šè¿‡å°†æ“ä½œä¼ é€’ç»™ `useActionState`,æ“ä½œçš„å‡½æ•°ç­¾åä¼šå‘ç”Ÿå˜åŒ–,æ¥æ”¶ä¸€ä¸ªæ–°çš„ `prevState` æˆ– `initialState` å‚æ•°ä½œä¸ºå…¶ç¬¬ä¸€ä¸ªå‚æ•°ã€‚
* `useActionState` æ˜¯ä¸€ä¸ª React é’©å­,å› æ­¤å¿…é¡»åœ¨å®¢æˆ·ç«¯ç»„ä»¶ä¸­ä½¿ç”¨ã€‚

::: tip
è¿™äº›ç¤ºä¾‹ä½¿ç”¨äº† React çš„ `useActionState` é’©å­,è¯¥é’©å­åœ¨ React 19 RC ä¸­å¯ç”¨ã€‚å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯æ—©æœŸç‰ˆæœ¬çš„ React,è¯·ä½¿ç”¨ `useFormState` ä»£æ›¿ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯,è¯·å‚é˜… [React æ–‡æ¡£](https://react.dev/reference/react/useActionState)ã€‚
:::

::: code-tabs
@tab app/actions.ts
``` typescript
'use server'
 
import { redirect } from 'next/navigation'
 
export async function createUser(prevState: any, formData: FormData) {
  const res = await fetch('https://...')
  const json = await res.json()
 
  if (!res.ok) {
    return { message: 'Please enter a valid email' }
  }
 
  redirect('/dashboard')
}
```
@tab app/actions.js
``` javascript
'use server'
 
import { redirect } from 'next/navigation'
 
export async function createUser(prevState, formData) {
  const res = await fetch('https://...')
  const json = await res.json()
 
  if (!res.ok) {
    return { message: 'Please enter a valid email' }
  }
 
  redirect('/dashboard')
}
```
:::

ç„¶å,æ‚¨å¯ä»¥å°†æ“ä½œä¼ é€’ç»™ `useActionState` é’©å­,å¹¶ä½¿ç”¨è¿”å›çš„ `state` æ¥æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ã€‚

::: code-tabs
@tab app/ui/signup.tsx
``` typescript{11,18-20}
'use client'
 
import { useActionState } from 'react'
import { createUser } from '@/app/actions'
 
const initialState = {
  message: '',
}
 
export function Signup() {
  const [state, formAction] = useActionState(createUser, initialState)
 
  return (
    <form action={formAction}>
      <label htmlFor="email">Email</label>
      <input type="text" id="email" name="email" required />
      {/* ... */}
      <p aria-live="polite">{state?.message}</p>
      <button>Sign up</button>
    </form>
  )
}
```
@tab app/ui/signup.js
``` javascript{11,18-20}
'use client'
 
import { useActionState } from 'react'
import { createUser } from '@/app/actions'
 
const initialState = {
  message: '',
}
 
export function Signup() {
  const [state, formAction] = useActionState(createUser, initialState)
 
  return (
    <form action={formAction}>
      <label htmlFor="email">Email</label>
      <input type="text" id="email" name="email" required />
      {/* ... */}
      <p aria-live="polite">{state?.message}</p>
      <button>Sign up</button>
    </form>
  )
}
```
:::

::: tip
åœ¨å˜æ›´æ•°æ®ä¹‹å‰,æ‚¨åº”å§‹ç»ˆç¡®ä¿ç”¨æˆ·ä¹Ÿè¢«æˆæƒæ‰§è¡Œè¯¥æ“ä½œã€‚è¯·å‚é˜…[èº«ä»½éªŒè¯å’Œæˆæƒ](about:blank#authentication-and-authorization)ã€‚
:::

#### **å¾…å®šçŠ¶æ€**

[`useActionState`](https://react.dev/reference/react/useActionState) é’©å­å…¬å¼€äº†ä¸€ä¸ª `pending` çŠ¶æ€,å¯ç”¨äºåœ¨æ‰§è¡Œæ“ä½œæ—¶æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨,è€Œä¸æ˜¯ç­‰å¾…å“åº”ã€‚

::: code-tabs
@tab app/submit-button.tsx
``` typescript{11,21-23}
'use client'
 
import { useActionState } from 'react'
import { createUser } from '@/app/actions'
 
const initialState = {
  message: '',
}
 
export function Signup() {
  const [state, formAction, pending] = useActionState(createUser, initialState)
 
  return (
    <form action={formAction}>
      <label htmlFor="email">Email</label>
      <input type="text" id="email" name="email" required />
      {/* ... */}
      <p aria-live="polite" className="sr-only">
        {state?.message}
      </p>
      <button aria-disabled={pending} type="submit">
        {pending ? 'Submitting...' : 'Sign up'}
      </button>
    </form>
  )
}
```
@tab app/submit-button.jsx
``` javascript{11,21-23}
'use client'
 
import { useActionState } from 'react'
import { createUser } from '@/app/actions'
 
const initialState = {
  message: '',
}
 
export function Signup() {
  const [state, formAction, pending] = useActionState(createUser, initialState)
 
  return (
    <form action={formAction}>
      <label htmlFor="email">Email</label>
      <input type="text" id="email" name="email" required />
      {/* ... */}
      <p aria-live="polite" className="sr-only">
        {state?.message}
      </p>
      <button aria-disabled={pending} type="submit">
        {pending ? 'Submitting...' : 'Sign up'}
      </button>
    </form>
  )
}
```
:::

::: tip
å¦ä¸€ç§é€‰æ‹©æ˜¯è¿˜å¯ä»¥ä½¿ç”¨ [`useFormStatus`](https://react.dev/reference/react-dom/hooks/useFormStatus) é’©å­ä¸ºç‰¹å®šè¡¨å•æ˜¾ç¤ºå¾…å®šçŠ¶æ€ã€‚
:::

#### **ä¹è§‚æ›´æ–°**

æ‚¨å¯ä»¥ä½¿ç”¨ React [`useOptimistic`](https://react.dev/reference/react/useOptimistic) é’©å­åœ¨æ“ä½œå®Œæˆæ‰§è¡Œä¹‹å‰ä¼˜å…ˆæ›´æ–° UI,è€Œä¸æ˜¯ç­‰å¾…å“åº”:

::: code-tabs
@tab app/page.tsx
``` typescript
'use client'
 
import { useOptimistic } from 'react'
import { send } from './actions'
 
type Message = {
  message: string
}
 
export function Thread({ messages }: { messages: Message[] }) {
  const [optimisticMessages, addOptimisticMessage] = useOptimistic<
    Message[],
    string
  >(messages, (state, newMessage) => [...state, { message: newMessage }])
 
  const formAction = async (formData) => {
    const message = formData.get('message') as string
    addOptimisticMessage(message)
    await send(message)
  }
 
  return (
    <div>
      {optimisticMessages.map((m, i) => (
        <div key={i}>{m.message}</div>
      ))}
      <form action={formAction}>
        <input type="text" name="message" />
        <button type="submit">Send</button>
      </form>
    </div>
  )
}
```
@tab app/page.jsx
``` javascript
'use client'
 
import { useOptimistic } from 'react'
import { send } from './actions'
 
export function Thread({ messages }) {
  const [optimisticMessages, addOptimisticMessage] = useOptimistic(
    messages,
    (state, newMessage) => [...state, { message: newMessage }]
  )
 
  const formAction = async (formData) => {
    const message = formData.get('message')
    addOptimisticMessage(message)
    await send(message)
  }
 
  return (
    <div>
      {optimisticMessages.map((m) => (
        <div>{m.message}</div>
      ))}
      <form action={formAction}>
        <input type="text" name="message" />
        <button type="submit">Send</button>
      </form>
    </div>
  )
}
```
:::

#### **äº‹ä»¶å¤„ç†ç¨‹åº**

è™½ç„¶åœ¨ `<form>` å…ƒç´ ä¸­ä½¿ç”¨æœåŠ¡å™¨æ“ä½œæ˜¯å¸¸è§çš„,ä½†å®ƒä»¬ä¹Ÿå¯ä»¥ä¸äº‹ä»¶å¤„ç†ç¨‹åº(å¦‚ `onClick`)ä¸€èµ·ä½¿ç”¨ã€‚ä¾‹å¦‚,è¦å¢åŠ ä¸€ä¸ªç‚¹èµè®¡æ•°:

::: code-tabs
@tab app/like-button.tsx
``` typescript
'use client'
 
import { incrementLike } from './actions'
import { useState } from 'react'
 
export default function LikeButton({ initialLikes }: { initialLikes: number }) {
  const [likes, setLikes] = useState(initialLikes)
 
  return (
    <>
      <p>Total Likes: {likes}</p>
      <button
        onClick={async () => {
          const updatedLikes = await incrementLike()
          setLikes(updatedLikes)
        }}
      >
        Like
      </button>
    </>
  )
}
```
@tab app/like-button.js
``` javascript
'use client'
 
import { incrementLike } from './actions'
import { useState } from 'react'
 
export default function LikeButton({ initialLikes }) {
  const [likes, setLikes] = useState(initialLikes)
 
  return (
    <>
      <p>Total Likes: {likes}</p>
      <button
        onClick={async () => {
          const updatedLikes = await incrementLike()
          setLikes(updatedLikes)
        }}
      >
        Like
      </button>
    </>
  )
}
```
:::

æ‚¨è¿˜å¯ä»¥å‘è¡¨å•å…ƒç´ æ·»åŠ äº‹ä»¶å¤„ç†ç¨‹åº,ä¾‹å¦‚,åœ¨ `onChange` æ—¶ä¿å­˜è¡¨å•å­—æ®µ:

::: code-tabs
@tab app/ui/edit-post.tsx
``` typescript
'use client'
 
import { publishPost, saveDraft } from './actions'
 
export default function EditPost() {
  return (
    <form action={publishPost}>
      <textarea
        name="content"
        onChange={async (e) => {
          await saveDraft(e.target.value)
        }}
      />
      <button type="submit">Publish</button>
    </form>
  )
}
```
:::

å¯¹äºè¿™ç§æƒ…å†µ,å½“å¯èƒ½ä¼šå¿«é€Ÿè¿ç»­è§¦å‘å¤šä¸ªäº‹ä»¶æ—¶,æˆ‘ä»¬å»ºè®®**å»æŠ–**ä»¥é˜²æ­¢ä¸å¿…è¦çš„æœåŠ¡å™¨æ“ä½œè°ƒç”¨ã€‚

#### **`useEffect`**

æ‚¨å¯ä»¥ä½¿ç”¨ React [`useEffect`](https://react.dev/reference/react/useEffect) é’©å­åœ¨ç»„ä»¶æŒ‚è½½æˆ–ä¾èµ–é¡¹æ›´æ”¹æ—¶è°ƒç”¨æœåŠ¡å™¨æ“ä½œã€‚è¿™åœ¨éœ€è¦ä¾èµ–å…¨å±€äº‹ä»¶æˆ–éœ€è¦è‡ªåŠ¨è§¦å‘çš„å˜æ›´æ—¶éå¸¸æœ‰ç”¨ã€‚ä¾‹å¦‚,`onKeyDown` ç”¨äºåº”ç”¨ç¨‹åºå¿«æ·æ–¹å¼,äº¤å‰è§‚å¯Ÿå™¨é’©å­ç”¨äºæ— é™æ»šåŠ¨,æˆ–è€…åœ¨ç»„ä»¶æŒ‚è½½æ—¶æ›´æ–°æŸ¥çœ‹è®¡æ•°:

::: code-tabs
@tab app/view-count.tsx
``` typescript
'use client'
 
import { incrementViews } from './actions'
import { useState, useEffect } from 'react'
 
export default function ViewCount({ initialViews }: { initialViews: number }) {
  const [views, setViews] = useState(initialViews)
 
  useEffect(() => {
    const updateViews = async () => {
      const updatedViews = await incrementViews()
      setViews(updatedViews)
    }
 
    updateViews()
  }, [])
 
  return <p>Total Views: {views}</p>
}
```
@tab app/view-count.js
``` javascript
'use client'
 
import { incrementViews } from './actions'
import { useState, useEffect } from 'react'
 
export default function ViewCount({ initialViews }: { initialViews: number }) {
  const [views, setViews] = useState(initialViews)
 
  useEffect(() => {
    const updateViews = async () => {
      const updatedViews = await incrementViews()
      setViews(updatedViews)
    }
 
    updateViews()
  }, [])
 
  return <p>Total Views: {views}</p>
}
```
:::

è¯·è®°ä½è€ƒè™‘ [`useEffect`](https://react.dev/reference/react/useEffect#caveats) çš„è¡Œä¸ºå’Œæ³¨æ„äº‹é¡¹ã€‚

#### **é”™è¯¯å¤„ç†**

å½“æŠ›å‡ºé”™è¯¯æ—¶,å®ƒå°†è¢«æœ€è¿‘çš„ [`error.js`](https://nextjs.org/docs/app/building-your-application/routing/error-handling) æˆ– `<Suspense>` è¾¹ç•Œåœ¨å®¢æˆ·ç«¯æ•è·ã€‚æˆ‘ä»¬å»ºè®®ä½¿ç”¨ `try/catch` å°†é”™è¯¯è¿”å›ç»™æ‚¨çš„ UI è¿›è¡Œå¤„ç†ã€‚

ä¾‹å¦‚,æ‚¨çš„æœåŠ¡å™¨æ“ä½œå¯èƒ½ä¼šåœ¨åˆ›å»ºæ–°é¡¹ç›®æ—¶å¤„ç†é”™è¯¯,å¹¶è¿”å›ä¸€æ¡æ¶ˆæ¯:

::: code-tabs
@tab app/actions.ts
``` typescript
'use server'
 
export async function createTodo(prevState: any, formData: FormData) {
  try {
    // Mutate data
  } catch (e) {
    throw new Error('Failed to create task')
  }
}
```
@tab app/actions.js
``` javascript
'use server'
 
export async function createTodo(prevState, formData) {
  try {
    //  Mutate data
  } catch (e) {
    throw new Error('Failed to create task')
  }
}
```
:::

:::tip
é™¤äº†æŠ›å‡ºé”™è¯¯ä¹‹å¤–,æ‚¨è¿˜å¯ä»¥è¿”å›ä¸€ä¸ªå¯¹è±¡ä¾› `useActionState` å¤„ç†ã€‚è¯·å‚é˜…[æœåŠ¡å™¨ç«¯éªŒè¯å’Œé”™è¯¯å¤„ç†](about:blank#server-side-form-validation)ã€‚
:::

#### **é‡æ–°éªŒè¯æ•°æ®**

æ‚¨å¯ä»¥ä½¿ç”¨ [`revalidatePath`](https://nextjs.org/docs/app/api-reference/functions/revalidatePath) API åœ¨æœåŠ¡å™¨æ“ä½œä¸­é‡æ–°éªŒè¯ Next.js ç¼“å­˜:

::: code-tabs
@tab app/actions.ts
``` typescript
'use server'
 
import { revalidatePath } from 'next/cache'
 
export async function createPost() {
  try {
    // ...
  } catch (error) {
    // ...
  }
 
  revalidatePath('/posts')
}
```
@tab app/actions.js
``` javascript
'use server'
 
import { revalidatePath } from 'next/cache'
 
export async function createPost() {
  try {
    // ...
  } catch (error) {
    // ...
  }
 
  revalidatePath('/posts')
}
```
:::

æˆ–ä½¿ç”¨ [`revalidateTag`](https://nextjs.org/docs/app/api-reference/functions/revalidateTag) ä½¿ç”¨ç¼“å­˜æ ‡ç­¾ä½¿ç‰¹å®šæ•°æ®è·å–å¤±æ•ˆ:

::: code-tabs
@tab app/actions.ts
``` typescript
'use server'
 
import { revalidateTag } from 'next/cache'
 
export async function createPost() {
  try {
    // ...
  } catch (error) {
    // ...
  }
 
  revalidateTag('posts')
}
```
@tab app/actions.js
``` javascript
'use server'
 
import { revalidateTag } from 'next/cache'
 
export async function createPost() {
  try {
    // ...
  } catch (error) {
    // ...
  }
 
  revalidateTag('posts')
}
```
:::

#### **é‡å®šå‘**

å¦‚æœæ‚¨å¸Œæœ›åœ¨æœåŠ¡å™¨æ“ä½œå®Œæˆåå°†ç”¨æˆ·é‡å®šå‘åˆ°ä¸åŒçš„è·¯ç”±,æ‚¨å¯ä»¥ä½¿ç”¨ [`redirect`](https://nextjs.org/docs/app/api-reference/functions/redirect) APIã€‚`redirect` éœ€è¦åœ¨ `try/catch` å—ä¹‹å¤–è°ƒç”¨:

::: code-tabs
@tab app/actions.ts
``` typescript
'use server'
 
import { redirect } from 'next/navigation'
import { revalidateTag } from 'next/cache'
 
export async function createPost(id: string) {
  try {
    // ...
  } catch (error) {
    // ...
  }
 
  revalidateTag('posts') // Update cached posts
  redirect(`/post/${id}`) // Navigate to the new post page
}
```
@tab app/actions.js
``` javascript
'use server'
 
import { redirect } from 'next/navigation'
import { revalidateTag } from 'next/cache'
 
export async function createPost(id) {
  try {
    // ...
  } catch (error) {
    // ...
  }
 
  revalidateTag('posts') // Update cached posts
  redirect(`/post/${id}`) // Navigate to the new post page
}
```
:::

#### **Cookies**

æ‚¨å¯ä»¥åœ¨æœåŠ¡å™¨æ“ä½œä¸­ä½¿ç”¨ [`cookies`](https://nextjs.org/docs/app/api-reference/functions/cookies) API æ¥ `get`ã€`set` å’Œ `delete` cookies:

::: code-tabs
@tab app/actions.ts
``` typescript
'use server'
 
import { cookies } from 'next/headers'
 
export async function exampleAction() {
  // Get cookie
  const value = cookies().get('name')?.value
 
  // Set cookie
  cookies().set('name', 'Delba')
 
  // Delete cookie
  cookies().delete('name')
}
```
@tab app/actions.js
``` javascript
'use server'
 
import { cookies } from 'next/headers'
 
export async function exampleAction() {
  // Get cookie
  const value = cookies().get('name')?.value
 
  // Set cookie
  cookies().set('name', 'Delba')
 
  // Delete cookie
  cookies().delete('name')
}
```
:::

è¯·å‚é˜…[å…¶ä»–ç¤ºä¾‹](https://nextjs.org/docs/app/api-reference/functions/cookies#deleting-cookies)ä»¥äº†è§£ä»æœåŠ¡å™¨æ“ä½œä¸­åˆ é™¤ cookies çš„ç¤ºä¾‹ã€‚

-----

### **å®‰å…¨**

#### **èº«ä»½éªŒè¯å’Œæˆæƒ**

æ‚¨åº”å°†æœåŠ¡å™¨æ“ä½œè§†ä¸ºå…¬å¼€çš„ API ç«¯ç‚¹,å¹¶ç¡®ä¿ç”¨æˆ·è¢«æˆæƒæ‰§è¡Œè¯¥æ“ä½œã€‚ä¾‹å¦‚:

::: code-tabs
@tab app/actions.ts
``` typescript
'use server'
 
import { auth } from './lib'
 
export function addItem() {
  const { user } = auth()
  if (!user) {
    throw new Error('You must be signed in to perform this action')
  }
 
  // ...
}
```
:::

#### **é—­åŒ…å’ŒåŠ å¯†**

åœ¨ç»„ä»¶å†…å®šä¹‰æœåŠ¡å™¨æ“ä½œä¼šåˆ›å»ºä¸€ä¸ª[é—­åŒ…](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Closures),å…¶ä¸­æ“ä½œå¯ä»¥è®¿é—®å¤–éƒ¨å‡½æ•°çš„ä½œç”¨åŸŸã€‚ä¾‹å¦‚,`publish` æ“ä½œå¯ä»¥è®¿é—® `publishVersion` å˜é‡:

::: code-tabs
@tab app/page.tsx
``` typescript
export default async function Page() {
  const publishVersion = await getLatestVersion();
 
  async function publish() {
    "use server";
    if (publishVersion !== await getLatestVersion()) {
      throw new Error('The version has changed since pressing publish');
    }
    ...
  }
 
  return (
    <form>
      <button formAction={publish}>Publish</button>
    </form>
  );
}
```
@tab app/page.js
``` javascript
export default async function Page() {
  const publishVersion = await getLatestVersion();
 
  async function publish() {
    "use server";
    if (publishVersion !== await getLatestVersion()) {
      throw new Error('The version has changed since pressing publish');
    }
    ...
  }
 
  return (
    <form>
      <button formAction={publish}>Publish</button>
    </form>
  );
}
```
:::

é—­åŒ…å¯¹äºéœ€è¦æ•è·æŸä¸ªæ—¶åˆ»çš„æ•°æ®å¿«ç…§(ä¾‹å¦‚ `publishVersion`)éå¸¸æœ‰ç”¨,ä»¥ä¾¿åœ¨ä»¥åè°ƒç”¨æ“ä½œæ—¶ä½¿ç”¨ã€‚

ä½†æ˜¯,ä¸ºäº†æ•è·è¿™äº›å˜é‡,å®ƒä»¬ä¼šéšç€æ“ä½œä¸€èµ·å‘é€åˆ°å®¢æˆ·ç«¯,ç„¶åå†å‘é€å›æœåŠ¡å™¨ã€‚ä¸ºäº†é˜²æ­¢æ•æ„Ÿæ•°æ®æ³„éœ²åˆ°å®¢æˆ·ç«¯,Next.js ä¼šè‡ªåŠ¨åŠ å¯†é—­åŒ…å˜é‡ã€‚æ¯æ¬¡æ„å»º Next.js åº”ç”¨ç¨‹åºæ—¶,éƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ç§é’¥,è¿™æ„å‘³ç€æ“ä½œåªèƒ½åœ¨ç‰¹å®šæ„å»ºä¸­è°ƒç”¨ã€‚

::: tip
æˆ‘ä»¬ä¸å»ºè®®ä»…ä¾èµ–åŠ å¯†æ¥é˜²æ­¢æ•æ„Ÿå€¼æ³„éœ²åˆ°å®¢æˆ·ç«¯ã€‚ç›¸å,æ‚¨åº”ä½¿ç”¨ React çš„æ±¡ç‚¹ API ä¸»åŠ¨é˜²æ­¢ç‰¹å®šæ•°æ®ä¼ é€’ç»™å®¢æˆ·ç«¯ã€‚
:::

#### **è¦†ç›–åŠ å¯†å¯†é’¥(é«˜çº§)**

å½“æ‚¨åœ¨å¤šä¸ªæœåŠ¡å™¨ä¸Šè‡ªæ‰˜ç®¡ Next.js åº”ç”¨ç¨‹åºæ—¶,æ¯ä¸ªæœåŠ¡å™¨å®ä¾‹å¯èƒ½ä¼šæœ‰ä¸åŒçš„åŠ å¯†å¯†é’¥,å¯¼è‡´æ½œåœ¨çš„ä¸ä¸€è‡´æ€§ã€‚

ä¸ºäº†ç¼“è§£è¿™ç§æƒ…å†µ,æ‚¨å¯ä»¥ä½¿ç”¨ `process.env.NEXT_SERVER_ACTIONS_ENCRYPTION_KEY` ç¯å¢ƒå˜é‡è¦†ç›–åŠ å¯†å¯†é’¥ã€‚æŒ‡å®šæ­¤å˜é‡å¯ç¡®ä¿æ‚¨çš„åŠ å¯†å¯†é’¥åœ¨æ„å»ºä¹‹é—´æ˜¯æŒä¹…çš„,å¹¶ä¸”æ‰€æœ‰æœåŠ¡å™¨å®ä¾‹ä½¿ç”¨ç›¸åŒçš„å¯†é’¥ã€‚

è¿™æ˜¯ä¸€ä¸ªé«˜çº§ç”¨ä¾‹,å½“åº”ç”¨ç¨‹åºåœ¨å¤šä¸ªéƒ¨ç½²ä¸­çš„ä¸€è‡´åŠ å¯†è¡Œä¸ºå¯¹æ‚¨çš„åº”ç”¨ç¨‹åºè‡³å…³é‡è¦æ—¶,è¿™æ˜¯å¿…è¦çš„ã€‚æ‚¨åº”è€ƒè™‘æ ‡å‡†çš„å®‰å…¨å®è·µ,å¦‚å¯†é’¥è½®æ¢å’Œç­¾åã€‚

::: tip
Next.js åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ° Vercel æ—¶ä¼šè‡ªåŠ¨å¤„ç†æ­¤é—®é¢˜ã€‚
:::

#### **å…è®¸çš„æ¥æº(é«˜çº§)**

ç”±äºæœåŠ¡å™¨æ“ä½œå¯ä»¥åœ¨ `<form>` å…ƒç´ ä¸­è°ƒç”¨,è¿™ä½¿å®ƒä»¬å®¹æ˜“å—åˆ° [CSRF æ”»å‡»](https://developer.mozilla.org/en-US/docs/Glossary/CSRF)çš„å½±å“ã€‚

åœ¨å¹•å,æœåŠ¡å™¨æ“ä½œä½¿ç”¨ `POST` æ–¹æ³•,å¹¶ä¸”åªæœ‰è¿™ç§ HTTP æ–¹æ³•å¯ä»¥è°ƒç”¨å®ƒä»¬ã€‚è¿™åœ¨ç°ä»£æµè§ˆå™¨ä¸­é˜²æ­¢äº†å¤§å¤šæ•° CSRF æ¼æ´,ç‰¹åˆ«æ˜¯å½“ä½¿ç”¨[SameSite cookies](https://web.dev/articles/samesite-cookies-explained) ä½œä¸ºé»˜è®¤å€¼æ—¶ã€‚

ä½œä¸ºé¢å¤–çš„ä¿æŠ¤æªæ–½,Next.js ä¸­çš„æœåŠ¡å™¨æ“ä½œè¿˜ä¼šå°† [Origin å¤´](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Origin)ä¸ [Host å¤´](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Host) (æˆ– `X-Forwarded-Host`)è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœå®ƒä»¬ä¸åŒ¹é…,è¯·æ±‚å°†è¢«ä¸­æ­¢ã€‚æ¢å¥è¯è¯´,æœåŠ¡å™¨æ“ä½œåªèƒ½åœ¨ä¸æ‰˜ç®¡å®ƒçš„é¡µé¢ç›¸åŒçš„ä¸»æœºä¸Šè°ƒç”¨ã€‚

å¯¹äºä½¿ç”¨åå‘ä»£ç†æˆ–å¤šå±‚åç«¯æ¶æ„çš„å¤§å‹åº”ç”¨ç¨‹åº(å…¶ä¸­æœåŠ¡å™¨ API ä¸ç”Ÿäº§åŸŸä¸åŒ),å»ºè®®ä½¿ç”¨é…ç½®é€‰é¡¹ [`serverActions.allowedOrigins`](https://nextjs.org/docs/app/api-reference/next-config-js/serverActions) æŒ‡å®šå®‰å…¨æ¥æºåˆ—è¡¨ã€‚è¯¥é€‰é¡¹æ¥å—å­—ç¬¦ä¸²æ•°ç»„ã€‚

::: code-tabs
@tab next.config.js
``` javascript
/** @type {import('next').NextConfig} */
module.exports = {
  experimental: {
    serverActions: {
      allowedOrigins: ['my-proxy.com', '*.my-proxy.com'],
    },
  },
}
```
:::

äº†è§£æ›´å¤šå…³äº[å®‰å…¨å’ŒæœåŠ¡å™¨æ“ä½œ](https://nextjs.org/blog/security-nextjs-server-components-actions)çš„ä¿¡æ¯ã€‚

-----

### **å…¶ä»–èµ„æº**

æœ‰å…³æœåŠ¡å™¨æ“ä½œçš„æ›´å¤šä¿¡æ¯,è¯·æŸ¥çœ‹ä»¥ä¸‹ React æ–‡æ¡£:

*   [æœåŠ¡å™¨æ“ä½œ](https://react.dev/reference/rsc/server-actions)
*   [`"use server"`](https://react.dev/reference/react/use-server)
*   [`<form>`](https://react.dev/reference/react-dom/components/form)
*   [`useFormStatus`](https://react.dev/reference/react-dom/hooks/useFormStatus)
*   [`useActionState`](https://react.dev/reference/react/useActionState)
*   [`useOptimistic`](https://react.dev/reference/react/useOptimistic)